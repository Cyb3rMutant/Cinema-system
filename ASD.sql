-- Active: 1666885728937@@127.0.0.1@3306@ASD

CREATE TABLE FILMS(
    FILM_TITLE VARCHAR(64) UNIQUE NOT NULL,
    FILM_RATING FLOAT NOT NULL,
    FILM_GENRE VARCHAR(512) NOT NULL,
    FILM_YEAR VARCHAR(4) NOT NULL,
    FILM_AGE_RATING VARCHAR(8) NOT NULL,
    FILM_DURATION INT NOT NULL,
    FILM_DESCRIPTION VARCHAR(512) NOT NULL,
    FILM_CAST VARCHAR(512) NOT NULL,
    PRIMARY KEY (FILM_TITLE)
);


CREATE TABLE CITIES(
    CITY_NAME VARCHAR(16) UNIQUE NOT NULL,
    CITY_MORNING_PRICE INT NOT NULL,
    CITY_AFTERNOON_PRICE INT NOT NULL,
    CITY_EVENING_PRICE INT NOT NULL,
    PRIMARY KEY (CITY_NAME)
);


CREATE TABLE CINEMAS(
    CINEMA_ID INT AUTO_INCREMENT NOT NULL,
    CINEMA_ADDRESS VARCHAR(128) NOT NULL,
    CITY_NAME VARCHAR(16) NOT NULL,
    PRIMARY KEY (CINEMA_ID),
    FOREIGN KEY (CITY_NAME) REFERENCES CITIES(CITY_NAME)
);

CREATE TABLE SCREENS(
    SCREEN_ID INT AUTO_INCREMENT NOT NULL,
    SCREEN_NUM_VIP_SEATS INT NOT NULL,
    SCREEN_NUM_UPPER_SEATS INT NOT NULL,
    SCREEN_NUM_LOWER_SEATS INT NOT NULL,
    CINEMA_ID INT NOT NULL,
    PRIMARY KEY (SCREEN_ID),
    FOREIGN KEY (CINEMA_ID) REFERENCES CINEMAS(CINEMA_ID)
);


CREATE TABLE LISTINGS(
    LISTING_ID INT AUTO_INCREMENT NOT NULL,
    LISTING_TIME DATETIME NOT NULL,
    FILM_TITLE VARCHAR(64),
    CINEMA_ID INT,
    PRIMARY KEY (SHOW_ID),
    FOREIGN KEY (FILM_TITLE) REFERENCES FILMS(FILM_TITLE),
    FOREIGN KEY (CINEMA_ID) REFERENCES CINEMAS(CINEMA_ID)
);


CREATE TABLE SHOWS(
    SHOW_ID INT AUTO_INCREMENT NOT NULL,
    SHOW_TIME DATETIME NOT NULL,
    SHOW_AVAILABLE_VIP_SEATS INT NOT NULL,
    SHOW_AVAILABLE_UPPER_SEATS INT NOT NULL,
    SHOW_AVAILABLE_LOWER_SEATS INT NOT NULL,
    FILM_TITLE VARCHAR(64),
    SCREEN_ID INT,
    LISTING_ID INT,
    PRIMARY KEY (SHOW_ID),
    FOREIGN KEY (FILM_TITLE) REFERENCES FILMS(FILM_TITLE),
    FOREIGN KEY (SCREEN_ID) REFERENCES SCREENS(SCREEN_ID)
    FOREIGN KEY (LISTING_ID) REFERENCES LISTINGS(LISTING_ID)
);


CREATE TABLE USER_TYPES(
    USER_TYPE VARCHAR(16) NOT NULL,
    PRIMARY KEY (USER_TYPE)
);

CREATE TABLE USERS(
    USER_ID INT AUTO_INCREMENT NOT NULL,
    USER_NAME VARCHAR(64) NOT NULL,
    USER_PASSWORD_HASH VARCHAR(128) NOT NULL,
    USER_TYPE VARCHAR(16) NOT NULL,
    CINEMA_ID INT NOT NULL,
    PRIMARY KEY(USER_ID),
    FOREIGN KEY (CINEMA_ID) REFERENCES CINEMAS(CINEMA_ID),
    FOREIGN KEY (USER_TYPE) REFERENCES USER_TYPES(USER_TYPE)
);


CREATE TABLE CUSTOMERS(
    CUSTOMER_EMAIL VARCHAR(128) UNIQUE NOT NULL,
    CUSTOMER_NAME VARCHAR(64) NOT NULL,
    CUSTOMER_PHONE VARCHAR(11) UNIQUE NOT NULL,
    PRIMARY KEY(CUSTOMER_EMAIL)
);



CREATE TABLE BOOKINGS(
    BOOKING_ID INT NOT NULL,
    BOOKING_REFERENCE VARCHAR(6) UNIQUE NOT NULL,
    BOOKING_SEAT_COUNT INT NOT NULL,
    BOOKING_DATE DATE NOT NULL,
    BOOKING_PRICE INT NOT NULL,
    SHOW_ID INT NOT NULL,
    SEAT_TYPE VARCHAR(16) NOT NULL,
    CUSTOMER_EMAIL VARCHAR(128) NOT NULL,
    PRIMARY KEY (BOOKING_ID),
    FOREIGN KEY (SHOW_ID) REFERENCES SHOWS(SHOW_ID),
    FOREIGN KEY (CUSTOMER_EMAIL) REFERENCES CUSTOMERS(CUSTOMER_EMAIL)
);